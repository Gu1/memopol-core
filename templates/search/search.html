 {% extends 'base.html' %}
{% load dynamiq_tags %}

{% block javascript %}
    <script type="text/javascript" src="{{ STATIC_URL }}dynamiq/js/inlines.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}dynamiq/js/dynamiq.js"></script>
{% endblock %}

{% block content %}
    <div class="dynamiq_shortcuts">
        Quick search:
        {% for shortcut in dynamiq.shortcuts %}
            <a href="{{ shortcut.get_url }}">{{ shortcut.get_title }}</a>
        {% endfor %}
        Mode: <a href="#" id="dynamiq_toggle_mode">simple / advanced</a>
        <script>
            jQuery(document).ready(function($){
                $('#dynamiq_toggle_mode').click(function(e) {
                    $('#dynamiq_advanced_search').toggle();
                    $('#dynamiq_search').toggle();
                    e.preventDefault();
                });
            });
        </script>
    </div>
    {% if dynamiq.results %}
        <div class="search_label">
            Searching {{ dynamiq.label|format_dynamiq_label }}
            {% if dynamiq.formset.is_bound %}
            <input id="relaunch_search" type="button" value="Edit search" />
            <script>
                jQuery(document).ready(function($){
                    $('#dynamiq_advanced_search').hide();
                    $('#relaunch_search').click(function(e) {
                        $(this).hide();
                        $('#dynamiq_advanced_search').show();
                        e.preventDefault();
                    });
                });
            </script>
            {% endif %}
        </div>
    {% endif %}
    {% render_dynamiq_advanced_formset request dynamiq.formset %}
    <div id="dynamiq_search" {% if dynamiq.formset.is_bound %}style="display:none;"{% endif %}>
        <form action="." method="get">
            <input type="text" name="q" value="{{ dynamiq.q }}" />
            <input type="submit" value="OK" />
        </form>
    </div>

    {% if dynamiq.results %}
        <table class="mep-list tablesorter">
          {% include "meps/meps_table_thead.html" %}
          <tbody>
            {% for result in  dynamiq.results %}
              {% include "meps/meps_table_tr.html" with mep=result.object %}
            {% endfor %}
          </tbody>
        </table>
    {% else %}
        {% if dynamiq.formset.is_bound or dynamiq.q != "" %}
            <p>No results found.</p>
        {% endif %}
    {% endif %}
{% endblock %}